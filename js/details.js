let restaurant,worker,id,reviews,reviewID;var newMap;document.addEventListener("DOMContentLoaded",e=>{SWHelper.registerServiceWorker(),this.reviews=[],this.worker=new Worker("/js/restaurantWorker.js"),this.worker.onmessage=handleWorkerMessage,this.id=Helper.getParameterByName("id"),this.reviewID=Helper.getParameterByName("review"),requestAnimationFrame(initReviews),getRestaurant(this.id),getReviews(this.id),requestAnimationFrame(fillFormTitle)}),handleWorkerMessage=(e=>{const t=e.data,r=t.msgData;switch(t.retrieved){case"restaurant":self.restaurant=r,requestAnimationFrame(initMap),requestAnimationFrame(fillRestaurantHTML);break;case"restaurantReviews":addReviews(r),requestAnimationFrame(resetReviews)}}),initMap=(()=>{const e=self.restaurant;self.newMap=L.map("map",{center:[e.latlng.lat,e.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoiYmluYXJ5aWRpb3QiLCJhIjoiY2pqMzZjNWRtMWF2YTNrbXRsb2VueGlydyJ9.mkjp31-552zW210Dz1PUcQ",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),Helper.mapMarkerForRestaurant(self.restaurant,self.newMap)}),initReviews=(()=>{const e=document.getElementById("reviews-container"),t=document.createElement("h3");t.innerHTML="Reviews",e.insertBefore(t,e.firstChild)}),getRestaurant=((e,t=self.worker)=>{t.postMessage({action:"getRestaurant",id:e})}),getReviews=((e,t=self.worker)=>{t.postMessage({action:"getRestaurantReviews",id:e})}),getReview=((e=self.reviewID)=>{for(review of self.reviews)if(review.id==Number(e))return review;return null}),addReviews=(e=>{for(newReview of e){let e=!1;for([index,review]of self.reviews.entries())if(review.id==newReview.id){e=!0,self.reviews[index]=newReview;break}e||self.reviews.push(newReview)}}),fillFormTitle=(()=>{const e=document.getElementById("form-title"),t=self.reviewID?"Update":"Create";e.innerHTML=`${t} review`}),fillRestaurantHTML=(()=>{const e=self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img"),r=Helper.imageUrlForRestaurant(e);t.className="restaurant-img",t.src=`${r}-small.jpg`,t.srcset=`${r}-small.jpg 300w, ${r}-medium.jpg 600w, ${r}-large.jpg 800w`,t.size="(max-width: 767) calc(100% - 30px), calc(50% - 30px)",t.alt=e.alt,document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillBreadcrumb()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let r in e){const n=document.createElement("tr"),a=document.createElement("td");a.innerHTML=r,n.appendChild(a);const i=document.createElement("td"),s=e[r].replace(/,/,"<br>");i.innerHTML=s,n.appendChild(i),t.appendChild(n)}}),fillBreadcrumb=(()=>{const e=self.restaurant,t=document.getElementById("breadcrumb"),r=document.createElement("li");r.innerHTML=e.name,t.appendChild(r)}),fillReviewHTML=(()=>{const e=self.reviews,t=document.getElementById("reviews-container");if(0==e.length){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.insertBefore(e,t.firstChild.nextSibling)}const r=document.getElementById("reviews-list");for(review of e)r.appendChild(createReviewHTML(review));t.insertBefore(r,t.firstChild.nextSibling)}),fillReviewForm=(()=>{console.log("filling review");const e=getReview();document.getElementById("review-name").value=e.name,document.getElementById("review-rating").value=e.rating,document.getElementById("review-comments").value=e.comments}),resetReviews=(()=>{const e=document.getElementById("no-reviews");e&&e.remove(),document.getElementById("reviews-list").innerHTML="",fillReviewHTML(),console.log("reset"),self.reviewID&&fillReviewForm()}),createReviewHTML=(e=>{const t=document.createElement("li"),r=document.createElement("div");r.classList.add("review-header");const n=document.createElement("p");n.innerHTML=e.name,n.classList.add("review-name"),r.appendChild(n);const a=document.createElement("p"),i=new Date(e.updatedAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});a.innerHTML=i,a.classList.add("review-date"),r.appendChild(a);const s=document.createElement("div");s.classList.add("review-content");const o=document.createElement("p");o.innerHTML=`Rating: ${e.rating}`,o.classList.add("review-rating"),s.appendChild(o);const l=document.createElement("p");return l.innerHTML=e.comments,l.classList.add("review-comments"),s.appendChild(l),t.appendChild(r),t.appendChild(s),t}),handleFormSubmit=(()=>{console.log("Form submitted")});
//# sourceMappingURL=../maps/details.js.map
