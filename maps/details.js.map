{"version":3,"sources":["details.js"],"names":["restaurant","worker","id","reviews","newMap","document","addEventListener","event","SWHelper","registerServiceWorker","this","Worker","onmessage","handleWorkerMessage","getParameterByName","requestAnimationFrame","initReviews","getRestaurant","getReviews","msg","data","content","msgData","retrieved","self","initMap","fillRestaurantHTML","addReviews","resetReviews","L","map","center","latlng","lat","lng","zoom","scrollWheelZoom","tileLayer","mapboxToken","maxZoom","attribution","addTo","Helper","mapMarkerForRestaurant","container","getElementById","title","createElement","innerHTML","appendChild","name","url","window","location","href","replace","results","RegExp","exec","decodeURIComponent","postMessage","action","newReviews","newReview","reviewFound","index","review","entries","push","address","image","imgSrc","imageUrlForRestaurant","className","src","srcset","size","alt","cuisine_type","operating_hours","fillRestaurantHoursHTML","fillBreadcrumb","operatingHours","hours","key","row","day","time","oh","breadcrumb","li","fillReviewHTML","length","noReviews","ul","createReviewHTML","remove","header","classList","add","date","dateString","Date","updatedAt","toLocaleDateString","year","month","rating","comments"],"mappings":"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","file":"../js/details.js","sourcesContent":["let restaurant,\r\n\tworker,\r\n\tid,\r\n\treviews;\r\n\r\nvar newMap;\r\n\r\n\tdocument.addEventListener('DOMContentLoaded', event => {\r\n\t\tSWHelper.registerServiceWorker();\r\n\r\n\t\tthis.reviews = [];\r\n\r\n\t\t// worker to handle all restaurant retrieval\r\n\t\tthis.worker = new Worker('/src/js/restaurantWorker.js');\r\n\t\tthis.worker.onmessage = handleWorkerMessage;\r\n\r\n\t\tthis.id = getParameterByName('id');\r\n\t\trequestAnimationFrame(initReviews);\r\n\t\tgetRestaurant(this.id);\r\n\t\tgetReviews(this.id);\r\n\t})\r\n\r\n/**\r\n * Handle messages from worker thread\r\n * @param  {Message} msg Message from worker thread\r\n */\r\nhandleWorkerMessage = msg => {\r\n\tconst data = msg.data;\r\n\tconst content = data.msgData;\r\n\r\n\tswitch(data.retrieved){\r\n\t\tcase 'restaurant':\r\n\t\t\tself.restaurant = content;\r\n\t\t\trequestAnimationFrame(initMap);\r\n\t\t\trequestAnimationFrame(fillRestaurantHTML);\r\n\t\t\tbreak;\r\n\t\tcase 'restaurantReviews':\r\n\t\t\taddReviews(content);\r\n\t\t\trequestAnimationFrame(resetReviews);\r\n\t}\r\n}\r\n\r\n/**\r\n * Initialize mapbox map\r\n */\r\ninitMap = () => {\r\n\tconst restaurant = self.restaurant;\r\n\tself.newMap = L.map('map', {\r\n\t    center: [restaurant.latlng.lat, restaurant.latlng.lng],\r\n\t    zoom: 16,\r\n\t    scrollWheelZoom: false\r\n\t  });\r\n\t  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}', {\r\n\t    mapboxToken: 'pk.eyJ1IjoiYmluYXJ5aWRpb3QiLCJhIjoiY2pqMzZjNWRtMWF2YTNrbXRsb2VueGlydyJ9.mkjp31-552zW210Dz1PUcQ',\r\n\t    maxZoom: 18,\r\n\t    attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, ' +\r\n\t      '<a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, ' +\r\n\t      'Imagery Â© <a href=\"https://www.mapbox.com/\">Mapbox</a>',\r\n\t    id: 'mapbox.streets'    \r\n\t  }).addTo(newMap);\r\n\r\n\t  Helper.mapMarkerForRestaurant(self.restaurant, self.newMap);\r\n}\r\n\r\n/**\r\n * Setup initial review container\r\n */\r\ninitReviews = () => {\r\n\tconst container = document.getElementById('reviews-container');\r\n\tconst title = document.createElement('h3');\r\n\ttitle.innerHTML = 'Reviews';\r\n\tcontainer.appendChild(title);\r\n}\r\n\r\n/**\r\n * get value of url param\r\n * @param  {String} name param to search for\r\n * @param  {String} url  url to search for\r\n * @return {String}      Value of param\r\n */\r\ngetParameterByName = (name, url) => {\r\n  if (!url) url = window.location.href;\r\n    name = name.replace(/[\\[\\]]/g, '\\\\$&');\r\n    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\r\n        results = regex.exec(url);\r\n    if (!results) return null;\r\n    if (!results[2]) return '';\r\n    return decodeURIComponent(results[2].replace(/\\+/g, ' '));\r\n}\r\n\r\n/**\r\n * Have the worker retrieve a restaurant\r\n * @param  {RestaurantWorker} worker worker to handle request\r\n * @param  {Int} id     id of restaurant to retrieve\r\n */\r\ngetRestaurant = (id, worker = self.worker) => {\r\n\tworker.postMessage({action: 'getRestaurant', id: id});\r\n}\r\n\r\ngetReviews = (id, worker = self.worker) => {\r\n\tworker.postMessage({action: 'getRestaurantReviews', id: id});\r\n}\r\n\r\n/**\r\n * Add or update self.reviews\r\n * @param  {Json} newReviews Restaurants to add\r\n */\r\naddReviews = newReviews => {\r\n\r\n\tfor(newReview of newReviews){\r\n\t\tlet reviewFound = false;\r\n\r\n\t\t// if review is already in self.reviews then update it otherwise add it to the list;\r\n\t\tfor([index, review] of self.reviews.entries()){\r\n\t\t\tif(review.id == newReview.id){\r\n\t\t\t\treviewFound = true;\r\n\t\t\t\tself.reviews[index] = newReview;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(!reviewFound){\r\n\t\t\tself.reviews.push(newReview);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Fill restaurant page with restaurant data\r\n * @param  {Json} restaurant Restaurant to fill page with\r\n */\r\nfillRestaurantHTML = () => {\r\n\tconst restaurant = self.restaurant;\r\n\r\n\tconst name = document.getElementById('restaurant-name');\r\n\tname.innerHTML = restaurant.name;\r\n\r\n\tconst address = document.getElementById('restaurant-address');\r\n\taddress.innerHTML = restaurant.address;\r\n\r\n\tconst image = document.getElementById('restaurant-img');\r\n\tconst imgSrc =  Helper.imageUrlForRestaurant(restaurant);\r\n\timage.className = 'restaurant-img'\r\n\timage.src = `${ imgSrc }-small.jpg`;\r\n\timage.srcset = `${ imgSrc }-small.jpg 300w, ${ imgSrc }-medium.jpg 600w, ${ imgSrc }-large.jpg 800w`;\r\n\timage.size = '(max-width: 767) calc(100% - 30px), calc(50% - 30px)';\r\n\timage.alt = restaurant.alt;\r\n\r\n\tconst cuisine = document.getElementById('restaurant-cuisine');\r\n\tcuisine.innerHTML = restaurant.cuisine_type;\r\n\r\n\t// fill operating hours\r\n\tif (restaurant.operating_hours) {\r\n\tfillRestaurantHoursHTML();\r\n\t}\r\n\r\n\t// TODO: Add reviews to page\r\n\tfillBreadcrumb();\r\n}\r\n\r\n/**\r\n * Fill operating hours section\r\n * @param  {Json} operatingHours Operating hours to add to page\r\n */\r\nfillRestaurantHoursHTML = (operatingHours = self.restaurant.operating_hours) => {\r\n\tconst hours = document.getElementById('restaurant-hours');\r\n\tfor (let key in operatingHours) {\r\n\t\tconst row = document.createElement('tr');\r\n\r\n\t\tconst day = document.createElement('td');\r\n\t\tday.innerHTML = key;\r\n\t\trow.appendChild(day);\r\n\r\n\t\tconst time = document.createElement('td');\r\n\t\tconst oh = operatingHours[key].replace(/,/, '<br>');\r\n\t\ttime.innerHTML = oh;\r\n\t\trow.appendChild(time);\r\n\r\n\t\thours.appendChild(row);\r\n\t}\r\n}\r\n\r\n/**\r\n * Fill page breadcrumb\r\n * @param  {Json} restaurant Restaurant for page\r\n */\r\nfillBreadcrumb = () => {\r\n\tconst restaurant = self.restaurant;\r\n\r\n\tconst breadcrumb = document.getElementById('breadcrumb');\r\n\tconst li = document.createElement('li');\r\n\tli.innerHTML = restaurant.name;\r\n\tbreadcrumb.appendChild(li);\r\n}\r\n\r\n/**\r\n * Add reviews to page\r\n */\r\nfillReviewHTML = () => {\r\n\tconst reviews = self.reviews;\r\n\tconst container = document.getElementById('reviews-container');\r\n\t\r\n\tif (reviews.length == 0) {\r\n\t\tconst noReviews = document.createElement('p');\r\n\t\tnoReviews.innerHTML = 'No reviews yet!';\r\n\t\tcontainer.appendChild(noReviews);\r\n\t\treturn;\r\n\t}\r\n\tconst ul = document.getElementById('reviews-list');\r\n\tfor(review of reviews){\r\n\t\tul.appendChild(createReviewHTML(review));\r\n\t}\r\n\tcontainer.appendChild(ul);\r\n\r\n}\r\n\r\n/**\r\n * Reset the review container\r\n */\r\nresetReviews = () => {\r\n\r\n\tconst noReviews = document.getElementById('no-reviews');\r\n\tif(noReviews)\r\n\t\tnoReviews.remove();\r\n\r\n\tconst ul = document.getElementById('reviews-list');\r\n\tul.innerHTML = '';\r\n\r\n\tfillReviewHTML();\r\n}\r\n\r\n/**\r\n * Create review item\r\n * @param  {Json} review The review to create\r\n * @return {HTML}        A li of the review\r\n */\r\ncreateReviewHTML = (review) => {\r\n\r\n\tconst li = document.createElement('li');\r\n\r\n\tconst header = document.createElement('div');\r\n\theader.classList.add(\"review-header\");\r\n\r\n\tconst name = document.createElement('p');\r\n\tname.innerHTML = review.name;\r\n\tname.classList.add('review-name');\r\n\theader.appendChild(name);\r\n\r\n\tconst date = document.createElement('p');\r\n\tconst dateMili = new Date(review.updatedAt); // Date is in milliseconds\r\n\tconst dateString = dateMili.toLocaleDateString('en-US', {year: 'numeric', month: 'short', day: 'numeric'});\r\n\tdate.innerHTML = dateString;\r\n\tdate.classList.add('review-date');\r\n\theader.appendChild(date);\r\n\r\n\tconst content = document.createElement('div');\r\n\tcontent.classList.add(\"review-content\");\r\n\r\n\tconst rating = document.createElement('p');\r\n\trating.innerHTML = `Rating: ${review.rating}`;\r\n\trating.classList.add('review-rating');\r\n\tcontent.appendChild(rating);\r\n\r\n\tconst comments = document.createElement('p');\r\n\tcomments.innerHTML = review.comments;\r\n\tcomments.classList.add('review-comments');\r\n\tcontent.appendChild(comments);\r\n\r\n\tli.appendChild(header);\r\n\tli.appendChild(content);\r\n\r\n\treturn li;\r\n}"]}